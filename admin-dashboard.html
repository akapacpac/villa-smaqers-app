<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Villa des Smaqers Bris√©s</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #6c5ce7;
        }
        .title {
            font-size: 28px;
            font-weight: bold;
            color: #6c5ce7;
            margin-bottom: 10px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #6c5ce7;
        }
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            color: #6c5ce7;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #636e72;
            font-size: 14px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        .section-icon {
            font-size: 24px;
            margin-right: 10px;
        }
        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .table th {
            background: #6c5ce7;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        .table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        .table tr:hover {
            background: #f8f9fa;
        }
        .btn {
            background: #6c5ce7;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        .btn:hover {
            background: #5a4fcf;
        }
        .btn-danger {
            background: #e74c3c;
        }
        .btn-danger:hover {
            background: #c0392b;
        }
        .btn-success {
            background: #00b894;
        }
        .btn-success:hover {
            background: #00a085;
        }
        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .filter-buttons {
            margin-bottom: 20px;
        }
        .filter-btn {
            background: #f8f9fa;
            color: #2d3436;
            border: 2px solid #ddd;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .filter-btn.active {
            background: #6c5ce7;
            color: white;
            border-color: #6c5ce7;
        }
        .export-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .no-data {
            text-align: center;
            color: #636e72;
            font-style: italic;
            padding: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">üèõÔ∏è Tableau de Bord Admin</div>
            <p>Villa des Smaqers Bris√©s - Gestion des commandes</p>
        </div>

        <!-- Statistics -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="total-orders">0</div>
                <div class="stat-label">Commandes totales</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="total-users">0</div>
                <div class="stat-label">Utilisateurs inscrits</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="today-orders">0</div>
                <div class="stat-label">Commandes aujourd'hui</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pending-orders">0</div>
                <div class="stat-label">En attente</div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="section">
            <div class="section-title">
                <span class="section-icon">üîç</span>
                Recherche et Filtres
            </div>
            <input type="text" id="search-box" class="search-box" placeholder="Rechercher par nom, email, ou produit...">
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterOrders('all')">Toutes</button>
                <button class="filter-btn" onclick="filterOrders('crepes')">Cr√™pes</button>
                <button class="filter-btn" onclick="filterOrders('cookies')">Cookies</button>
                <button class="filter-btn" onclick="filterOrders('glaces')">Glaces</button>
                <button class="filter-btn" onclick="filterOrders('today')">Aujourd'hui</button>
            </div>
        </div>

        <!-- Export Section -->
        <div class="export-section">
            <div class="section-title">
                <span class="section-icon">üìä</span>
                Exporter les donn√©es
            </div>
            <button class="btn btn-success" onclick="exportToCSV()">üìÑ Exporter en CSV</button>
            <button class="btn" onclick="exportToJSON()">üìã Exporter en JSON</button>
            <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Effacer toutes les donn√©es</button>
        </div>

        <!-- Orders Table -->
        <div class="section">
            <div class="section-title">
                <span class="section-icon">üìù</span>
                Commandes r√©centes
            </div>
            <div id="orders-container">
                <table class="table" id="orders-table">
                    <thead>
                        <tr>
                            <th>Date/Heure</th>
                            <th>Nom</th>
                            <th>Email</th>
                            <th>Produit</th>
                            <th>Salle</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="orders-tbody">
                        <tr>
                            <td colspan="7" class="no-data">Aucune commande trouv√©e</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Users Table -->
        <div class="section">
            <div class="section-title">
                <span class="section-icon">üë•</span>
                Utilisateurs inscrits
            </div>
            <div id="users-container">
                <table class="table" id="users-table">
                    <thead>
                        <tr>
                            <th>Nom</th>
                            <th>Email</th>
                            <th>T√©l√©phone</th>
                            <th>√Çge</th>
                            <th>Inscription</th>
                            <th>Commandes</th>
                        </tr>
                    </thead>
                    <tbody id="users-tbody">
                        <tr>
                            <td colspan="6" class="no-data">Aucun utilisateur trouv√©</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let allOrders = [];
        let allUsers = [];
        let currentFilter = 'all';

        // Load data from localStorage
        function loadData() {
            allOrders = JSON.parse(localStorage.getItem('villa-smaqers-orders') || '[]');
            allUsers = JSON.parse(localStorage.getItem('villa-smaqers-users') || '[]');
            updateStats();
            displayOrders();
            displayUsers();
        }

        // Update statistics
        function updateStats() {
            const today = new Date().toDateString();
            const todayOrders = allOrders.filter(order => 
                new Date(order.timestamp).toDateString() === today
            );
            const pendingOrders = allOrders.filter(order => 
                order.status === 'pending' || !order.status
            );

            document.getElementById('total-orders').textContent = allOrders.length;
            document.getElementById('total-users').textContent = allUsers.length;
            document.getElementById('today-orders').textContent = todayOrders.length;
            document.getElementById('pending-orders').textContent = pendingOrders.length;
        }

        // Display orders
        function displayOrders(orders = allOrders) {
            const tbody = document.getElementById('orders-tbody');
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="no-data">Aucune commande trouv√©e</td></tr>';
                return;
            }

            tbody.innerHTML = orders.map(order => `
                <tr>
                    <td>${order.timestamp}</td>
                    <td>${order.profile.firstName} ${order.profile.lastName}</td>
                    <td>${order.profile.email}</td>
                    <td>${order.item}</td>
                    <td>${order.classroom}</td>
                    <td>
                        <span style="color: ${order.status === 'completed' ? '#00b894' : order.status === 'pending' ? '#f39c12' : '#6c5ce7'};">
                            ${order.status === 'completed' ? '‚úÖ Termin√©' : order.status === 'pending' ? '‚è≥ En attente' : 'üÜï Nouveau'}
                        </span>
                    </td>
                    <td>
                        <button class="btn" onclick="markCompleted('${order.id}')">‚úÖ Terminer</button>
                        <button class="btn btn-danger" onclick="deleteOrder('${order.id}')">üóëÔ∏è Supprimer</button>
                    </td>
                </tr>
            `).join('');
        }

        // Display users
        function displayUsers() {
            const tbody = document.getElementById('users-tbody');
            
            if (allUsers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="no-data">Aucun utilisateur trouv√©</td></tr>';
                return;
            }

            tbody.innerHTML = allUsers.map(user => {
                const userOrders = allOrders.filter(order => order.profile.email === user.email);
                return `
                    <tr>
                        <td>${user.firstName} ${user.lastName}</td>
                        <td>${user.email}</td>
                        <td>${user.phone}</td>
                        <td>${user.age} ans</td>
                        <td>${user.registrationDate || 'Inconnu'}</td>
                        <td>${userOrders.length}</td>
                    </tr>
                `;
            }).join('');
        }

        // Filter orders
        function filterOrders(filter) {
            currentFilter = filter;
            
            // Update filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            let filteredOrders = allOrders;

            switch(filter) {
                case 'crepes':
                    filteredOrders = allOrders.filter(order => order.item.toLowerCase().includes('cr√™pe'));
                    break;
                case 'cookies':
                    filteredOrders = allOrders.filter(order => order.item.toLowerCase().includes('cookie'));
                    break;
                case 'glaces':
                    filteredOrders = allOrders.filter(order => order.item.toLowerCase().includes('glace'));
                    break;
                case 'today':
                    const today = new Date().toDateString();
                    filteredOrders = allOrders.filter(order => 
                        new Date(order.timestamp).toDateString() === today
                    );
                    break;
            }

            displayOrders(filteredOrders);
        }

        // Search functionality
        document.getElementById('search-box').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const filteredOrders = allOrders.filter(order => 
                order.profile.firstName.toLowerCase().includes(searchTerm) ||
                order.profile.lastName.toLowerCase().includes(searchTerm) ||
                order.profile.email.toLowerCase().includes(searchTerm) ||
                order.item.toLowerCase().includes(searchTerm) ||
                order.classroom.toLowerCase().includes(searchTerm)
            );
            displayOrders(filteredOrders);
        });

        // Mark order as completed
        function markCompleted(orderId) {
            const orderIndex = allOrders.findIndex(order => order.id === orderId);
            if (orderIndex !== -1) {
                allOrders[orderIndex].status = 'completed';
                localStorage.setItem('villa-smaqers-orders', JSON.stringify(allOrders));
                loadData();
            }
        }

        // Delete order
        function deleteOrder(orderId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette commande ?')) {
                allOrders = allOrders.filter(order => order.id !== orderId);
                localStorage.setItem('villa-smaqers-orders', JSON.stringify(allOrders));
                loadData();
            }
        }

        // Export to CSV
        function exportToCSV() {
            const csvContent = [
                ['Date', 'Nom', 'Email', 'T√©l√©phone', 'Produit', 'Salle', 'Statut'],
                ...allOrders.map(order => [
                    order.timestamp,
                    `${order.profile.firstName} ${order.profile.lastName}`,
                    order.profile.email,
                    order.profile.phone,
                    order.item,
                    order.classroom,
                    order.status || 'Nouveau'
                ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `commandes-villa-smaqers-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        // Export to JSON
        function exportToJSON() {
            const data = {
                orders: allOrders,
                users: allUsers,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `villa-smaqers-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
        }

        // Clear all data
        function clearAllData() {
            if (confirm('√ätes-vous s√ªr de vouloir effacer TOUTES les donn√©es ? Cette action est irr√©versible !')) {
                localStorage.removeItem('villa-smaqers-orders');
                localStorage.removeItem('villa-smaqers-users');
                localStorage.removeItem('villa-smaqers-profile');
                loadData();
                alert('Toutes les donn√©es ont √©t√© effac√©es.');
            }
        }

        // Initialize
        loadData();
    </script>
</body>
</html>