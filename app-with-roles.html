<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Villa des Smaqers Bris√©s</title>
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#6c5ce7">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Villa Smaqers">
    <link rel="apple-touch-icon" href="./assets/icon.png">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDqCYiGvSYitgoPnGdxMzkautcYl511E3I",
            authDomain: "villa-smaqers-brises.firebaseapp.com",
            projectId: "villa-smaqers-brises",
            storageBucket: "villa-smaqers-brises.firebasestorage.app",
            messagingSenderId: "387262093007",
            appId: "1:387262093007:web:76173a1e3cd49d80a249ba",
            measurementId: "G-TBNFR17E82"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.db = db;
        window.addDoc = addDoc;
        window.getDocs = getDocs;
        window.collection = collection;
        window.deleteDoc = deleteDoc;
        window.updateDoc = updateDoc;
        window.doc = doc;
        window.onSnapshot = onSnapshot;
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            min-height: 100vh;
            color: #2d3436;
        }
        
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #2d3436;
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            left: -250px;
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar.open {
            left: 0;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #636e72;
            margin-bottom: 20px;
        }
        
        .sidebar-title {
            font-size: 18px;
            font-weight: bold;
            color: #6c5ce7;
        }
        
        .sidebar-subtitle {
            font-size: 14px;
            color: #b2bec3;
            margin-top: 5px;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 5px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: #b2bec3;
            text-decoration: none;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-link:hover {
            background: #636e72;
            color: white;
        }
        
        .nav-link.active {
            background: #6c5ce7;
            color: white;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-right: 15px;
            width: 20px;
            text-align: center;
        }
        
        .nav-text {
            font-size: 16px;
        }
        
        .admin-section {
            border-top: 1px solid #636e72;
            margin-top: 20px;
            padding-top: 20px;
        }
        
        .admin-label {
            font-size: 12px;
            color: #f39c12;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 0 20px;
        }
        
        .member-section {
            border-top: 1px solid #636e72;
            margin-top: 20px;
            padding-top: 20px;
        }
        
        .member-label {
            font-size: 12px;
            color: #00b894;
            text-transform: uppercase;
            font-weight: bold;
            margin-bottom: 10px;
            padding: 0 20px;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 0;
            transition: margin-left 0.3s ease;
        }
        
        .main-content.sidebar-open {
            margin-left: 250px;
        }
        
        .top-bar {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .menu-toggle {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6c5ce7;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: #6c5ce7;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .user-name {
            font-weight: bold;
            color: #2d3436;
        }
        
        .user-role {
            font-size: 12px;
            color: #636e72;
        }
        
        .content-area {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .card-title {
            font-size: 20px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .card-icon {
            font-size: 24px;
            margin-right: 10px;
            color: #6c5ce7;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #2d3436;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #6c5ce7;
        }
        
        .btn {
            background: #6c5ce7;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a4fcf;
        }
        
        .btn-secondary {
            background: #636e72;
        }
        
        .btn-secondary:hover {
            background: #2d3436;
        }
        
        .btn-success {
            background: #00b894;
        }
        
        .btn-success:hover {
            background: #00a085;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-full {
            width: 100%;
        }
        
        .role-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .role-card {
            background: #f8f9fa;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .role-card:hover {
            border-color: #6c5ce7;
            transform: translateY(-2px);
        }
        
        .role-card.selected {
            border-color: #6c5ce7;
            background: #e8f5e8;
        }
        
        .role-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .role-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }
        
        .role-desc {
            color: #636e72;
            font-size: 14px;
        }
        
        .code-input {
            font-family: 'Courier New', monospace;
            font-size: 18px;
            letter-spacing: 2px;
            text-align: center;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .menu-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .menu-item:hover {
            transform: translateY(-5px);
            border-color: #6c5ce7;
            box-shadow: 0 8px 25px rgba(108, 92, 231, 0.2);
        }
        
        .menu-item-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .menu-item-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3436;
            margin-bottom: 8px;
        }
        
        .menu-item-desc {
            color: #636e72;
            font-size: 14px;
        }
        
        .order-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #6c5ce7;
        }
        
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .order-date {
            font-size: 12px;
            color: #636e72;
        }
        
        .order-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-pending {
            background: #f39c12;
            color: white;
        }
        
        .status-completed {
            background: #00b894;
            color: white;
        }
        
        .status-new {
            background: #6c5ce7;
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #6c5ce7, #a29bfe);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .table th {
            background: #6c5ce7;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .table tr:hover {
            background: #f8f9fa;
        }
        
        .hidden {
            display: none;
        }
        
        .success-message {
            background: #00b894;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
        
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        
        .overlay.show {
            display: block;
        }
        
        .role-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .badge-admin {
            background: #e74c3c;
            color: white;
        }
        
        .badge-member {
            background: #00b894;
            color: white;
        }
        
        .badge-student {
            background: #6c5ce7;
            color: white;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                left: -100%;
            }
            
            .main-content.sidebar-open {
                margin-left: 0;
            }
            
            .role-selection {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">Villa des Smaqers</div>
                <div class="sidebar-subtitle">Bris√©s</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a class="nav-link active" data-page="home">
                        <span class="nav-icon">üè†</span>
                        <span class="nav-text">Accueil</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="order">
                        <span class="nav-icon">üçΩÔ∏è</span>
                        <span class="nav-text">Passer commande</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="my-orders">
                        <span class="nav-icon">üìã</span>
                        <span class="nav-text">Mes commandes</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-page="settings">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span class="nav-text">Param√®tres</span>
                    </a>
                </li>
                
                <!-- Member Section -->
                <div class="member-section" id="member-section" style="display: none;">
                    <div class="member-label">Membre Soci√©t√©</div>
                    <li class="nav-item">
                        <a class="nav-link" data-page="all-orders">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text">Toutes les commandes</span>
                        </a>
                    </li>
                </div>
                
                <!-- Admin Section -->
                <div class="admin-section" id="admin-section" style="display: none;">
                    <div class="admin-label">Administration</div>
                    <li class="nav-item">
                        <a class="nav-link" data-page="statistics">
                            <span class="nav-icon">üìà</span>
                            <span class="nav-text">Statistiques</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="manage-orders">
                            <span class="nav-icon">üìù</span>
                            <span class="nav-text">G√©rer commandes</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-page="users">
                            <span class="nav-icon">üë•</span>
                            <span class="nav-text">Utilisateurs</span>
                        </a>
                    </li>
                </div>
            </ul>
        </nav>
        
        <!-- Overlay for mobile -->
        <div class="overlay" id="overlay"></div>
        
        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <button class="menu-toggle" id="menu-toggle">‚ò∞</button>
                <div class="user-info" id="user-info">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div>
                        <div class="user-name" id="user-name">Utilisateur</div>
                        <div class="user-role" id="user-role">√âtudiant</div>
                    </div>
                </div>
            </div>
            
            <!-- Content Area -->
            <div class="content-area">
                <!-- Home Page -->
                <div class="page active" id="home-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üè†</span>
                            Bienvenue √† la Villa des Smaqers Bris√©s
                        </div>
                        <p>Commandez gratuitement vos cr√™pes, cookies et glaces !</p>
                        <div class="menu-grid">
                            <div class="menu-item" onclick="navigateTo('order')">
                                <div class="menu-item-icon">üçΩÔ∏è</div>
                                <div class="menu-item-title">Passer commande</div>
                                <div class="menu-item-desc">Cr√™pes, cookies, glaces</div>
                            </div>
                            <div class="menu-item" onclick="navigateTo('my-orders')">
                                <div class="menu-item-icon">üìã</div>
                                <div class="menu-item-title">Mes commandes</div>
                                <div class="menu-item-desc">Voir l'historique</div>
                            </div>
                            <div class="menu-item" onclick="navigateTo('settings')">
                                <div class="menu-item-icon">‚öôÔ∏è</div>
                                <div class="menu-item-title">Param√®tres</div>
                                <div class="menu-item-desc">G√©rer mon profil</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Registration Page -->
                <div class="page" id="registration-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üë§</span>
                            Cr√©er un compte
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Type de compte *</label>
                            <div class="role-selection">
                                <div class="role-card" onclick="selectRole('student')">
                                    <div class="role-icon">üéì</div>
                                    <div class="role-title">√âtudiant</div>
                                    <div class="role-desc">Commander des produits</div>
                                </div>
                                <div class="role-card" onclick="selectRole('member')">
                                    <div class="role-icon">üèõÔ∏è</div>
                                    <div class="role-title">Membre Soci√©t√©</div>
                                    <div class="role-desc">Voir les commandes</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Pr√©nom *</label>
                            <input type="text" id="reg-firstName" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Nom *</label>
                            <input type="text" id="reg-lastName" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" id="reg-email" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone *</label>
                            <input type="tel" id="reg-phone" class="form-input" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">√Çge *</label>
                            <input type="number" id="reg-age" class="form-input" required min="16" max="99">
                        </div>
                        
                        <div class="form-group" id="code-section" style="display: none;">
                            <label class="form-label">Code d'acc√®s *</label>
                            <input type="text" id="access-code" class="form-input code-input" placeholder="Entrez le code" maxlength="10">
                            <small style="color: #636e72; margin-top: 5px; display: block;">
                                Demandez le code √† un administrateur
                            </small>
                        </div>
                        
                        <button class="btn btn-full" onclick="registerUser()">Cr√©er le compte</button>
                    </div>
                </div>
                
                <!-- Order Page -->
                <div class="page" id="order-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üçΩÔ∏è</span>
                            Notre Menu
                        </div>
                        <div class="menu-grid">
                            <div class="menu-item" onclick="selectItem('Cr√™pes')">
                                <div class="menu-item-icon">ü•û</div>
                                <div class="menu-item-title">Cr√™pes</div>
                                <div class="menu-item-desc">D√©licieuses cr√™pes sucr√©es ou sal√©es</div>
                            </div>
                            <div class="menu-item" onclick="selectItem('Cookies')">
                                <div class="menu-item-icon">üç™</div>
                                <div class="menu-item-title">Cookies</div>
                                <div class="menu-item-desc">Cookies maison aux p√©pites de chocolat</div>
                            </div>
                            <div class="menu-item" onclick="selectItem('Glaces')">
                                <div class="menu-item-icon">üç¶</div>
                                <div class="menu-item-title">Glaces</div>
                                <div class="menu-item-desc">Glaces artisanales aux saveurs vari√©es</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Form -->
                    <div class="card" id="order-form" style="display: none;">
                        <div class="card-title">
                            <span class="card-icon">üìù</span>
                            Ma Commande
                        </div>
                        <div class="form-group">
                            <label class="form-label">Article s√©lectionn√©</label>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-weight: bold; color: #6c5ce7;" id="selected-item-display"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Salle de classe *</label>
                            <select id="classroom" class="form-input" required>
                                <option value="">Choisissez votre salle</option>
                                <option value="A101">A101</option>
                                <option value="A102">A102</option>
                                <option value="B201">B201</option>
                                <option value="B202">B202</option>
                                <option value="C301">C301</option>
                                <option value="C302">C302</option>
                                <option value="Autre">Autre</option>
                            </select>
                        </div>
                        <div class="form-group" id="other-classroom" style="display: none;">
                            <label class="form-label">Pr√©cisez la salle</label>
                            <input type="text" id="customClassroom" class="form-input" placeholder="Ex: D401">
                        </div>
                        <button class="btn btn-full" onclick="placeOrder()">Passer la commande</button>
                        <button class="btn btn-secondary btn-full" onclick="backToMenu()" style="margin-top: 10px;">Retour au menu</button>
                    </div>
                </div>
                
                <!-- My Orders Page -->
                <div class="page" id="my-orders-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üìã</span>
                            Mes Commandes
                        </div>
                        <div id="my-orders-list">
                            <p>Aucune commande trouv√©e</p>
                        </div>
                    </div>
                </div>
                
                <!-- All Orders Page (Members) -->
                <div class="page" id="all-orders-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üìä</span>
                            Toutes les Commandes
                        </div>
                        <div id="all-orders-list">
                            <p>Aucune commande trouv√©e</p>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Page -->
                <div class="page" id="settings-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">‚öôÔ∏è</span>
                            Param√®tres
                        </div>
                        <div id="profile-info">
                            <h3>Mon Profil</h3>
                            <p><strong>Nom:</strong> <span id="profile-name"></span></p>
                            <p><strong>Email:</strong> <span id="profile-email"></span></p>
                            <p><strong>T√©l√©phone:</strong> <span id="profile-phone"></span></p>
                            <p><strong>√Çge:</strong> <span id="profile-age"></span> ans</p>
                            <p><strong>R√¥le:</strong> <span id="profile-role"></span></p>
                            <button class="btn" onclick="editProfile()">Modifier le profil</button>
                            <button class="btn btn-danger" onclick="logout()" style="margin-left: 10px;">Se d√©connecter</button>
                        </div>
                        
                        <div id="profile-form" style="display: none;">
                            <h3>Modifier le profil</h3>
                            <div class="form-group">
                                <label class="form-label">Pr√©nom *</label>
                                <input type="text" id="firstName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nom *</label>
                                <input type="text" id="lastName" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email *</label>
                                <input type="email" id="email" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">T√©l√©phone *</label>
                                <input type="tel" id="phone" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">√Çge *</label>
                                <input type="number" id="age" class="form-input" required min="16" max="99">
                            </div>
                            <button class="btn" onclick="saveProfile()">Sauvegarder</button>
                            <button class="btn btn-secondary" onclick="cancelEdit()">Annuler</button>
                        </div>
                    </div>
                </div>
                
                <!-- Statistics Page (Admin) -->
                <div class="page" id="statistics-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üìà</span>
                            Statistiques
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number" id="total-orders">0</div>
                                <div class="stat-label">Commandes totales</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="total-users">0</div>
                                <div class="stat-label">Utilisateurs</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="today-orders">0</div>
                                <div class="stat-label">Aujourd'hui</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number" id="pending-orders">0</div>
                                <div class="stat-label">En attente</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Manage Orders Page (Admin) -->
                <div class="page" id="manage-orders-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üìù</span>
                            G√©rer les Commandes
                        </div>
                        <div id="admin-orders-list">
                            <p>Aucune commande trouv√©e</p>
                        </div>
                    </div>
                </div>
                
                <!-- Users Page (Admin) -->
                <div class="page" id="users-page">
                    <div class="card">
                        <div class="card-title">
                            <span class="card-icon">üë•</span>
                            Utilisateurs
                        </div>
                        <div id="admin-users-list">
                            <p>Aucun utilisateur trouv√©</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Access codes
        const ACCESS_CODES = {
            'paco': 'admin',           // Your admin code
            'member123': 'member',     // Member code
            'admin456': 'admin',       // Another admin code
            'society789': 'member'     // Another member code
        };
        
        let currentUser = null;
        let selectedRole = null;
        
        // Initialize app
        function initApp() {
            loadUser();
            setupEventListeners();
            updateUI();
        }
        
        // Load user from localStorage
        function loadUser() {
            const profile = localStorage.getItem('villa-smaqers-profile');
            if (profile) {
                currentUser = JSON.parse(profile);
            } else {
                // Show registration page
                navigateTo('registration');
                return;
            }
        }
        
        // Load user from Firebase (for future use)
        async function loadUserFromFirebase(email) {
            try {
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const users = [];
                usersSnapshot.forEach(doc => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                
                const user = users.find(u => u.email === email);
                if (user) {
                    currentUser = user;
                    localStorage.setItem('villa-smaqers-profile', JSON.stringify(currentUser));
                    return true;
                }
                return false;
            } catch (error) {
                console.error('Erreur lors du chargement de l\'utilisateur:', error);
                return false;
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Menu toggle
            document.getElementById('menu-toggle').addEventListener('click', toggleSidebar);
            document.getElementById('overlay').addEventListener('click', closeSidebar);
            
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const page = link.getAttribute('data-page');
                    navigateTo(page);
                    closeSidebar();
                });
            });
            
            // Classroom selection
            document.getElementById('classroom').addEventListener('change', function() {
                const otherDiv = document.getElementById('other-classroom');
                if (this.value === 'Autre') {
                    otherDiv.style.display = 'block';
                } else {
                    otherDiv.style.display = 'none';
                }
            });
        }
        
        // Select role
        function selectRole(role) {
            selectedRole = role;
            
            // Update UI
            document.querySelectorAll('.role-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.role-card').classList.add('selected');
            
            // Show/hide code section
            const codeSection = document.getElementById('code-section');
            if (role === 'member') {
                codeSection.style.display = 'block';
            } else {
                codeSection.style.display = 'none';
            }
        }
        
        // Register user
        async function registerUser() {
            const firstName = document.getElementById('reg-firstName').value;
            const lastName = document.getElementById('reg-lastName').value;
            const email = document.getElementById('reg-email').value;
            const phone = document.getElementById('reg-phone').value;
            const age = document.getElementById('reg-age').value;
            const accessCode = document.getElementById('access-code').value;
            
            if (!firstName || !lastName || !email || !phone || !age) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            let userRole = 'student';
            
            if (selectedRole === 'member') {
                if (!accessCode) {
                    alert('Veuillez entrer le code d\'acc√®s');
                    return;
                }
                
                const codeRole = ACCESS_CODES[accessCode.toLowerCase()];
                if (!codeRole) {
                    alert('Code d\'acc√®s invalide');
                    return;
                }
                
                userRole = codeRole;
            }
            
            try {
                // Create user
                currentUser = {
                    firstName,
                    lastName,
                    email,
                    phone,
                    age: parseInt(age),
                    role: userRole,
                    registrationDate: new Date().toISOString()
                };
                
                // Save user to Firebase
                await addDoc(collection(db, 'users'), currentUser);
                
                // Save current user profile locally for quick access
                localStorage.setItem('villa-smaqers-profile', JSON.stringify(currentUser));
                
                // Navigate to home
                navigateTo('home');
                updateUI();
                
                alert('Compte cr√©√© avec succ√®s !');
            } catch (error) {
                console.error('Erreur lors de la cr√©ation du compte:', error);
                alert('Erreur lors de la cr√©ation du compte. Veuillez r√©essayer.');
            }
        }
        
        // Update UI based on user role
        function updateUI() {
            if (!currentUser) return;
            
            // Update user info
            document.getElementById('user-name').textContent = currentUser.firstName + ' ' + currentUser.lastName;
            document.getElementById('user-role').textContent = getRoleText(currentUser.role);
            document.getElementById('user-avatar').textContent = currentUser.firstName.charAt(0).toUpperCase();
            
            // Show/hide sections based on role
            const memberSection = document.getElementById('member-section');
            const adminSection = document.getElementById('admin-section');
            
            if (currentUser.role === 'admin') {
                memberSection.style.display = 'block';
                adminSection.style.display = 'block';
            } else if (currentUser.role === 'member') {
                memberSection.style.display = 'block';
                adminSection.style.display = 'none';
            } else {
                memberSection.style.display = 'none';
                adminSection.style.display = 'none';
            }
            
            // Update profile info
            document.getElementById('profile-name').textContent = currentUser.firstName + ' ' + currentUser.lastName;
            document.getElementById('profile-email').textContent = currentUser.email;
            document.getElementById('profile-phone').textContent = currentUser.phone;
            document.getElementById('profile-age').textContent = currentUser.age;
            document.getElementById('profile-role').innerHTML = getRoleText(currentUser.role) + getRoleBadge(currentUser.role);
        }
        
        // Get role text
        function getRoleText(role) {
            switch(role) {
                case 'admin': return 'Administrateur';
                case 'member': return 'Membre Soci√©t√©';
                case 'student': return '√âtudiant';
                default: return 'Utilisateur';
            }
        }
        
        // Get role badge
        function getRoleBadge(role) {
            switch(role) {
                case 'admin': return '<span class="role-badge badge-admin">ADMIN</span>';
                case 'member': return '<span class="role-badge badge-member">MEMBRE</span>';
                case 'student': return '<span class="role-badge badge-student">√âTUDIANT</span>';
                default: return '';
            }
        }
        
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('open');
            mainContent.classList.toggle('sidebar-open');
            overlay.classList.toggle('show');
        }
        
        // Close sidebar
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.remove('open');
            mainContent.classList.remove('sidebar-open');
            overlay.classList.remove('show');
        }
        
        // Navigate to page
        function navigateTo(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            
            // Show selected page
            document.getElementById(page + '-page').classList.add('active');
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const navLink = document.querySelector(`[data-page="${page}"]`);
            if (navLink) {
                navLink.classList.add('active');
            }
            
            // Load page data
            loadPageData(page);
        }
        
        // Load page data
        function loadPageData(page) {
            switch(page) {
                case 'my-orders':
                    loadMyOrders();
                    break;
                case 'all-orders':
                    loadAllOrders();
                    break;
                case 'statistics':
                    loadStatistics();
                    break;
                case 'manage-orders':
                    loadAdminOrders();
                    break;
                case 'users':
                    loadAdminUsers();
                    break;
            }
        }
        
        // Load my orders
        async function loadMyOrders() {
            try {
                const ordersSnapshot = await getDocs(collection(db, 'orders'));
                const orders = [];
                ordersSnapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                const myOrders = orders.filter(order => order.profile.email === currentUser.email);
                
                const container = document.getElementById('my-orders-list');
                if (myOrders.length === 0) {
                    container.innerHTML = '<p>Aucune commande trouv√©e</p>';
                    return;
                }
                
                container.innerHTML = myOrders.map(order => `
                    <div class="order-item">
                        <div class="order-header">
                            <strong>${order.item}</strong>
                            <span class="order-status status-${order.status || 'new'}">${getStatusText(order.status)}</span>
                        </div>
                        <div class="order-date">${order.timestamp}</div>
                        <div>Salle: ${order.classroom}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erreur lors du chargement des commandes:', error);
                document.getElementById('my-orders-list').innerHTML = '<p>Erreur lors du chargement des commandes</p>';
            }
        }
        
        // Load all orders (for members)
        async function loadAllOrders() {
            try {
                const ordersSnapshot = await getDocs(collection(db, 'orders'));
                const orders = [];
                ordersSnapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                const container = document.getElementById('all-orders-list');
                if (orders.length === 0) {
                    container.innerHTML = '<p>Aucune commande trouv√©e</p>';
                    return;
                }
                
                container.innerHTML = orders.map(order => `
                    <div class="order-item">
                        <div class="order-header">
                            <strong>${order.item}</strong>
                            <span class="order-status status-${order.status || 'new'}">${getStatusText(order.status)}</span>
                        </div>
                        <div class="order-date">${order.timestamp}</div>
                        <div><strong>Client:</strong> ${order.profile.firstName} ${order.profile.lastName}</div>
                        <div><strong>Email:</strong> ${order.profile.email}</div>
                        <div><strong>Salle:</strong> ${order.classroom}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Erreur lors du chargement des commandes:', error);
                document.getElementById('all-orders-list').innerHTML = '<p>Erreur lors du chargement des commandes</p>';
            }
        }
        
        // Load statistics
        async function loadStatistics() {
            try {
                const [ordersSnapshot, usersSnapshot] = await Promise.all([
                    getDocs(collection(db, 'orders')),
                    getDocs(collection(db, 'users'))
                ]);
                
                const orders = [];
                ordersSnapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                const users = [];
                usersSnapshot.forEach(doc => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                
                const today = new Date().toDateString();
                const todayOrders = orders.filter(order => 
                    new Date(order.timestamp).toDateString() === today
                );
                const pendingOrders = orders.filter(order => 
                    order.status === 'pending' || !order.status
                );
                
                document.getElementById('total-orders').textContent = orders.length;
                document.getElementById('total-users').textContent = users.length;
                document.getElementById('today-orders').textContent = todayOrders.length;
                document.getElementById('pending-orders').textContent = pendingOrders.length;
            } catch (error) {
                console.error('Erreur lors du chargement des statistiques:', error);
            }
        }
        
        // Load admin orders
        async function loadAdminOrders() {
            try {
                const ordersSnapshot = await getDocs(collection(db, 'orders'));
                const orders = [];
                ordersSnapshot.forEach(doc => {
                    orders.push({ id: doc.id, ...doc.data() });
                });
                
                const container = document.getElementById('admin-orders-list');
                if (orders.length === 0) {
                    container.innerHTML = '<p>Aucune commande trouv√©e</p>';
                    return;
                }
                
                container.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>Produit</th>
                                <th>Salle</th>
                                <th>Statut</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${orders.map(order => `
                                <tr>
                                    <td>${order.timestamp}</td>
                                    <td>${order.profile.firstName} ${order.profile.lastName}</td>
                                    <td>${order.profile.email}</td>
                                    <td>${order.item}</td>
                                    <td>${order.classroom}</td>
                                    <td>
                                        <span class="order-status status-${order.status || 'new'}">${getStatusText(order.status)}</span>
                                    </td>
                                    <td>
                                        <button class="btn" onclick="markCompleted('${order.id}')">‚úÖ</button>
                                        <button class="btn btn-danger" onclick="deleteOrder('${order.id}')">üóëÔ∏è</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error('Erreur lors du chargement des commandes:', error);
                document.getElementById('admin-orders-list').innerHTML = '<p>Erreur lors du chargement des commandes</p>';
            }
        }
        
        // Load admin users
        async function loadAdminUsers() {
            try {
                const usersSnapshot = await getDocs(collection(db, 'users'));
                const users = [];
                usersSnapshot.forEach(doc => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                
                const container = document.getElementById('admin-users-list');
                if (users.length === 0) {
                    container.innerHTML = '<p>Aucun utilisateur trouv√©</p>';
                    return;
                }
                
                container.innerHTML = `
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Email</th>
                                <th>T√©l√©phone</th>
                                <th>√Çge</th>
                                <th>R√¥le</th>
                                <th>Inscription</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${users.map(user => `
                                <tr>
                                    <td>${user.firstName} ${user.lastName}</td>
                                    <td>${user.email}</td>
                                    <td>${user.phone}</td>
                                    <td>${user.age} ans</td>
                                    <td>${getRoleText(user.role)} ${getRoleBadge(user.role)}</td>
                                    <td>${user.registrationDate ? new Date(user.registrationDate).toLocaleDateString() : 'Inconnu'}</td>
                                    <td>
                                        <button class="btn btn-danger" onclick="deleteUser('${user.id}')">üóëÔ∏è</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            } catch (error) {
                console.error('Erreur lors du chargement des utilisateurs:', error);
                document.getElementById('admin-users-list').innerHTML = '<p>Erreur lors du chargement des utilisateurs</p>';
            }
        }
        
        // Select item for order
        function selectItem(item) {
            document.getElementById('selected-item-display').textContent = item;
            document.getElementById('order-form').style.display = 'block';
            document.getElementById('order-form').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Back to menu
        function backToMenu() {
            document.getElementById('order-form').style.display = 'none';
        }
        
        // Place order
        async function placeOrder() {
            const classroom = document.getElementById('classroom').value;
            const customClassroom = document.getElementById('customClassroom').value;
            const selectedItem = document.getElementById('selected-item-display').textContent;
            
            if (!classroom) {
                alert('Veuillez s√©lectionner une salle de classe');
                return;
            }
            
            const finalClassroom = classroom === 'Autre' ? customClassroom : classroom;
            
            if (classroom === 'Autre' && !customClassroom) {
                alert('Veuillez pr√©ciser la salle de classe');
                return;
            }
            
            try {
                // Save order to Firebase
                const order = {
                    item: selectedItem,
                    classroom: finalClassroom,
                    timestamp: new Date().toLocaleString('fr-FR'),
                    profile: currentUser,
                    status: 'pending'
                };
                
                await addDoc(collection(db, 'orders'), order);
                
                alert('Commande pass√©e avec succ√®s !');
                backToMenu();
                document.getElementById('classroom').value = '';
                document.getElementById('customClassroom').value = '';
            } catch (error) {
                console.error('Erreur lors de la commande:', error);
                alert('Erreur lors de la commande. Veuillez r√©essayer.');
            }
        }
        
        // Edit profile
        function editProfile() {
            document.getElementById('profile-info').style.display = 'none';
            document.getElementById('profile-form').style.display = 'block';
            
            document.getElementById('firstName').value = currentUser.firstName;
            document.getElementById('lastName').value = currentUser.lastName;
            document.getElementById('email').value = currentUser.email;
            document.getElementById('phone').value = currentUser.phone;
            document.getElementById('age').value = currentUser.age;
        }
        
        // Save profile
        function saveProfile() {
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const age = document.getElementById('age').value;
            
            if (!firstName || !lastName || !email || !phone || !age) {
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            currentUser = {
                ...currentUser,
                firstName,
                lastName,
                email,
                phone,
                age: parseInt(age)
            };
            
            localStorage.setItem('villa-smaqers-profile', JSON.stringify(currentUser));
            updateUI();
            cancelEdit();
        }
        
        // Cancel edit
        function cancelEdit() {
            document.getElementById('profile-form').style.display = 'none';
            document.getElementById('profile-info').style.display = 'block';
        }
        
        // Logout
        function logout() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                localStorage.removeItem('villa-smaqers-profile');
                currentUser = null;
                navigateTo('registration');
            }
        }
        
        // Mark order as completed
        async function markCompleted(orderId) {
            try {
                await updateDoc(doc(db, 'orders', orderId), {
                    status: 'completed'
                });
                loadAdminOrders();
            } catch (error) {
                console.error('Erreur lors de la mise √† jour:', error);
                alert('Erreur lors de la mise √† jour de la commande');
            }
        }
        
        // Delete order
        async function deleteOrder(orderId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cette commande ?')) {
                try {
                    await deleteDoc(doc(db, 'orders', orderId));
                    loadAdminOrders();
                } catch (error) {
                    console.error('Erreur lors de la suppression:', error);
                    alert('Erreur lors de la suppression de la commande');
                }
            }
        }
        
        // Delete user
        async function deleteUser(userId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet utilisateur ?')) {
                try {
                    await deleteDoc(doc(db, 'users', userId));
                    loadAdminUsers();
                } catch (error) {
                    console.error('Erreur lors de la suppression:', error);
                    alert('Erreur lors de la suppression de l\'utilisateur');
                }
            }
        }
        
        // Get status text
        function getStatusText(status) {
            switch(status) {
                case 'completed': return 'Termin√©';
                case 'pending': return 'En attente';
                default: return 'Nouveau';
            }
        }
        
        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
